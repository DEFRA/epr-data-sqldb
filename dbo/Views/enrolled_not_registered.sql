CREATE VIEW [dbo].[enrolled_not_registered] AS SELECT 
a.[Organisations_Id],a.[FromOrganisation_TypeId]
,a.[FromOrganisation_Type]
,a.[FromOrganisation_CompaniesHouseNumber]
,a.[FromOrganisation_Name]
,a.[FromOrganisation_TradingName]
,a.[FromOrganisation_ReferenceNumber]
,a.[FromOrganisation_SubBuildingName]
,a.[FromOrganisation_BuildingName]
,a.[FromOrganisation_BuildingNumber]
,a.[FromOrganisation_Street]
,a.[FromOrganisation_Locality]
,a.[FromOrganisation_DependentLocality]
,a.[FromOrganisation_Town]
,a.[FromOrganisation_County]
,a.[FromOrganisation_Country]
,a.[FromOrganisation_Postcode]
,a.[FromOrganisation_ValidatedWithCompaniesHouse]
,a.[FromOrganisation_IsComplianceScheme]
,a.[FromOrganisation_NationId]
,a.[Organisations_CreatedOn]
,a.[FromOrganisation_IsDeleted]
,a.[FromOrganisation_ProducerTypeId]
,a.[FromOrganisation_TransferNationId]
,a.[ToOrganisation_TypeId]
,a.[ToOrganisation_Type]
,a.[ToOrganisation_CompaniesHouseNumber]
,a.[ToOrganisation_Name]
,a.[ToOrganisation_TradingName]
,a.[ToOrganisation_ReferenceNumber]
,a.[ToOrganisation_SubBuildingName]
,a.[ToOrganisation_BuildingName]
,a.[ToOrganisation_BuildingNumber]
,a.[ToOrganisation_Street]
,a.[ToOrganisation_Locality]
,a.[ToOrganisation_DependentLocality]
,a.[ToOrganisation_Town]
,a.[ToOrganisation_County]
,a.[ToOrganisation_Country]
,a.[ToOrganisation_Postcode]
,a.[ToOrganisation_ValidatedWithCompaniesHouse]
,a.[ToOrganisation_IsComplianceScheme]
,a.[ToOrganisation_NationId]
,a.[ToOrganisation_IsDeleted]
,a.[ToOrganisation_ProducerTypeId]
,a.[ToOrganisation_TransferNationId]
,a.[OrganisationConnections_Id]
,a.[OrganisationConnections_FromOrganisationId]
,a.[OrganisationConnections_FromOrganisationRoleId]
,a.[OrganisationConnections_ToOrganisationId]
,a.[OrganisationConnections_ToOrganisationRoleId]
,a.[OrganisationConnections_CreatedOn]
,a.[OrganisationConnections_LastUpdatedOn]
,a.[OrganisationConnections_IsDeleted]
,a.[SelectedSchemes_Id]
,a.[SelectedSchemes_OrganisationConnectionId]
,a.[SelectedSchemes_ComplianceSchemeId]
,a.[SelectedSchemes_CreatedOn]
,a.[SelectedSchemes_LastUpdatedOn]
,a.[SelectedSchemes_IsDeleted]
,a.[ComplianceSchemes_Id]
,a.[ComplianceSchemes_Name]
,a.[ComplianceSchemes_CreatedOn]
,a.[ComplianceSchemes_LastUpdatedOn]
,a.[ComplianceSchemes_IsDeleted]
,a.[ComplianceSchemes_CompaniesHouseNumber]
,a.[InterOrganisationRoles_FromOrganisationRole]
,a.[InterOrganisationRoles_ToOrganisationRole]
,a.[PersonOrganisationConnections_Id]
,a.[PersonOrganisationConnections_OrganisationId]
,a.[PersonOrganisationConnections_JobTitle]
,a.[PersonOrganisationConnections_ExternalId]
,a.[PersonOrganisationConnections_CreatedOn]
,a.[PersonOrganisationConnections_LastUpdatedOn]
,a.[PersonOrganisationConnections_IsDeleted]
,a.[OrganisationToPersonRoles_Role]
,a.[PersonInOrganisationRoles_Role]
,a.[Persons_Id]
,a.[Persons_FirstName]
,a.[Persons_LastName]
,a.[Persons_Email]
,a.[Persons_Telephone]
,a.[Persons_CreatedOn]
,a.[Persons_LastUpdatedOn]
,a.[Persons_IsDeleted]
,a.[Users_Email]
,a.[Users_IsDeleted]
,a.[Users_InviteToken]
,a.[Users_InvitedBy]
,a.[Enrolment_Id]
,a.[Enrolment_ConnectionId]
,a.[Enrolment_ServiceRoleId]
,a.[Enrolment_ValidFrom]
,a.[Enrolment_ValidTo]
,a.[Enrolment_ExternalId]
,a.[Enrolment_CreatedOn]
,a.[Enrolment_LastUpdatedOn]
,a.[Enrolment_IsDeleted]
,a.[Enrolment_RegulatorCommentId]
,a.[EnrolmentStatuses_EnrolmentStatus]
,a.[ServiceRoles_Id]
,a.[ServiceRoles_ServiceId]
,a.[ServiceRoles_Key]
,a.[ServiceRoles_Role]
,a.[ServiceRoles_Description]
,a.[Services_Key]
,a.[Services_Service]
,a.[Services_Description]
,a.[DelegatedPersonEnrolment_RelationshipType]
,a.[DelegatedPersonEnrolment_ConsultancyName]
,a.[DelegatedPersonEnrolment_ComplianceSchemeName]
,a.[DelegatedPersonEnrolment_OtherOrganisationNation]
,a.[DelegatedPersonEnrolment_OtherRelationshipDescription]
,a.[DelegatedPersonEnrolment_NominatorDeclaration]
,a.[DelegatedPersonEnrolment_NominatorDeclarationTime]
,a.[DelegatedPersonEnrolment_NomineeDeclaration]
,a.[DelegatedPersonEnrolment_NomineeDeclarationTime]
,a.[DelegatedPersonEnrolment_CreatedOn]
,a.[DelegatedPersonEnrolment_LastUpdatedOn]
,a.[DelegatedPersonEnrolment_IsDeleted]
,a.[NominatedDelegatedPersonEnrolment_RelationshipType]
,a.[NominatedDelegatedPersonEnrolment_ConsultancyName]
,a.[NominatedDelegatedPersonEnrolment_ComplianceSchemeName]
,a.[NominatedDelegatedPersonEnrolment_OtherOrganisationNation]
,a.[NominatedDelegatedPersonEnrolment_OtherRelationshipDescription]
,a.[NominatedDelegatedPersonEnrolment_NominatorDeclaration]
,a.[NominatedDelegatedPersonEnrolment_NominatorDeclarationTime]
,a.[NominatedDelegatedPersonEnrolment_NomineeDeclaration]
,a.[NominatedDelegatedPersonEnrolment_NomineeDeclarationTime]
,a.[NominatedDelegatedPersonEnrolment_CreatedOn]
,a.[NominatedDelegatedPersonEnrolment_LastUpdatedOn]
,a.[NominatedDelegatedPersonEnrolment_IsDeleted]
,a.[FromOrganisation_NationName]
,a.[ToOrganisation_NationName]
,a.[Security_Id]
,a.[SecurityQuery]
,a.[SecurityQuery_OrganisationOrigin]
,a.[ApprovedPerson_Id]
,a.[ApprovedPerson_FirstName]
,a.[ApprovedPerson_LastName]
,a.[ApprovedPerson_Email]
,a.[ApprovedPerson_Telephone]
,a.[ApprovedPerson_CreatedOn]
,a.[ApprovedPerson_LastUpdatedOn]
,a.[ApprovedPerson_IsDeleted]
,a.[ApprovedPerson_JobTitle]
,a.[DelegatedPerson_Id]
,a.[DelegatedPerson_FirstName]
,a.[DelegatedPerson_LastName]
,a.[DelegatedPerson_Email]
,a.[DelegatedPerson_Telephone]
,a.[DelegatedPerson_CreatedOn]
,a.[DelegatedPerson_LastUpdatedOn]
,a.[DelegatedPerson_IsDeleted]
,a.[DelegatedPerson_JobTitle]
,a.[Status]
,a.Regulator_Rejection_Comments
,a.Decision_Date
,a.Regulator_User_Name

FROM [v_rpd_data_SECURITY_FIX] a -- Enrolment


WHERE NOT EXISTS 
	(SELECT organisation_id
	FROM [rpd].[CompanyDetails] b
	WHERE a.FromOrganisation_ReferenceNumber = b.organisation_id);